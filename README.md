# EcoSim: Симуляция Экосистемы на Pygame

Этот документ описывает проект **EcoSim**, простую, но расширяемую симуляцию экосистемы, разработанную на языке Python с использованием библиотеки Pygame. Цель проекта - наглядно продемонстрировать базовые принципы взаимодействия живых организмов и окружающей среды в экосистеме.

## 1. Обзор

EcoSim позволяет моделировать поведение травоядных и хищников, их взаимодействие с ресурсами (едой и водой), а также влияние смены дня и ночи. Пользователь может вмешиваться в симуляцию, изменяя параметры и наблюдая за последствиями.

## 2. Структура Кода

Код организован по объектно-ориентированному принципу. Основные составляющие:

•   **Pygame:**  Основная библиотека для графики, ввода и управления окном.
•   **`Ecosystem`:** Центральный класс, управляющий всеми сущностями (животными, ресурсами) и общими параметрами симуляции (карта, смена дня и ночи).
•   **`Entity`:** Базовый класс, определяющий общие свойства и поведение для всех живых организмов (положение, скорость, здоровье, потребности, размножение).
•   **`Herbivore`:** Класс, представляющий травоядных. Реализует логику поиска еды, воды и размножения.  Наследуется от `Entity`.
•   **`Predator`:** Класс, представляющий хищников. Реализует логику охоты, поедания добычи и размножения. Наследуется от `Entity`.
•   **`Food` и `Water`:** Классы, представляющие ресурсы: еду и источники воды.
•   **`ResourceManager`:** Класс, управляющий загрузкой и хранением ресурсов (музыки, изображений).  (В текущей версии используется только для музыки).
•   **`DayNightCycle`:** Класс, управляющий сменой дня и ночи, влияя на освещение и поведение организмов.

## 3. Классы

### `Game`

Основной класс, управляющий всем ходом игры.

•   **Атрибуты:**
    •   `width`, `height`: Размеры игрового окна.
    •   `screen`:  Объект `Surface` Pygame, на котором происходит отрисовка.
    •   `clock`: Объект `Clock` Pygame для управления частотой кадров (FPS).
    •   `is_running`:  Логическая переменная, определяющая, запущена ли игра.
    •   `ecosystem`:  Экземпляр класса `Ecosystem`, содержащий данные об экосистеме.
    •   `resource_manager`:  Экземпляр класса `ResourceManager`.
    •   `debug_font`: Объект шрифта Pygame для отладочной информации.
    •   `fps`:  Текущее значение FPS (кадров в секунду).
    •   `show_entity_info`:  Флаг для включения/выключения отображения информации о выбранных сущностях.
    •   `is_paused`:  Флаг для приостановки/возобновления симуляции питье воды, размножение).
    *   `draw(self, screen)`: Отрисовывает сущность на экране.
    *   `draw_info(self, screen)`: Отрисовывает информацию о сущности (здоровье, голод, жажда) на экране.
    *   `find_reproduction_target(self, entities)`: Ищет партнера для размножения среди других сущностей.
    *   `find_water_target(self, water_sources)`: Ищет ближайший источник воды.
    *   `find_nearest(self, items)`: Находит ближайший объект из списка (например, ближайший "труп").

### `Herbivore`

Класс, представляющий травоядное животное. Наследуется от `Entity`.

*   Реализует специфичное для травоядных поведение: поиск и поедание еды, поиск воды, избегание хищников, размножение.

### `Predator`

Класс, представляющий хищное животное. Наследуется от `Entity`.

*   Реализует специфичное для хищников поведение: охота на травоядных, поедание "трупов" (eating crosses), поиск воды, размножение.

### `Food`

Класс, представляющий ресурс еды.

*   **Атрибуты:**
    *   `x`, `y`: Координаты еды на карте.
    *   `size`: Размер еды.
    *   `color`: Цвет еды.

*   **Метод:**
    *   `draw(self, screen)`: Отрисовывает еду на экране.

### `Water`

Класс, представляющий источник воды.

*   **Атрибуты:**
    *   `x`, `y`: Координаты источника воды на карте.
    *   `size`: Размер источника воды.
    *   `color`: Цвет источника воды.

*   **Метод:**
    *   `draw(self, screen)`: Отрисовывает источник воды на экране.

### `ResourceManager`

Управляет загрузкой и хранением ресурсов (музыки, изображений).

*   **Атрибуты:**
    *   `sounds`: Словарь для хранения загруженных звуков.
    *   `images`: Словарь для хранения загруженных изображений.

*   **Методы:**
    *   `load_sound(self, name, path)`: Загружает звук из файла и сохраняет его в словаре `sounds`.
    *   `load_image(self, name, path)`: Загружает изображение из файла и сохраняет его в словаре `images`.

### `DayNightCycle`

Управляет сменой дня и ночи, изменяя цвет фона и влияя на поведение организмов.

*   **Атрибуты:**
    *   `day_length`: Длительность дня (в кадрах).
    *   `night_length`: Длительность ночи (в кадрах).
    *   `transition_duration`: Длительность переходов между днем и ночью (в кадрах).
    *   `timer`: Текущее время в цикле день-ночь.
    *   `time_scale`: Масштаб времени (для ускорения или замедления смены дня и ночи).

*   **Методы:**
    *   `update(self, dt)`: Обновляет таймер цикла день-ночь.
    *   `get_time_progress(self)`: Возвращает прогресс текущего времени дня (от 0 до 1).
    *   `is_day(self)`: Проверяет, является ли текущее время днем.
    *   `get_background_color(self)`: Определяет цвет фона в зависимости от времени суток (использует линейную интерполяцию между дневным и ночным цветом).

## 4. Как Запустить

1.  **Установите Pygame:**
*   **Методы:**
    *   `__init__(self, width, height)`:  Конструктор класса. Инициализирует игру, создаёт окно Pygame,  создаёт экземпляры `Ecosystem` и `ResourceManager`, устанавливает начальные параметры.
    *   `create_initial_entities(self)`:  Создаёт начальную популяцию травоядных и хищников.
    *   `create_initial_resources(self)`:  Создаёт начальный запас еды на карте.
    *   `create_initial_water_sources(self)`:  Создаёт начальные источники воды на карте.
    *   `handle_input(self)`:  Обрабатывает ввод пользователя (нажатия клавиш, движения мыши).
    *   `update(self, dt)`:  Обновляет состояние игры.  Вызывается каждый кадр. Обновляет экосистему, обрабатывает логику симуляции.  `dt` - это время, прошедшее с предыдущего кадра (delta time).
    *   `draw(self)`: Отрисовывает игру на экране.  Вызывается каждый кадр.  Рисует фон, сущности, ресурсы, отладочную информацию.
    *   `run(self)`:  Основной игровой цикл.  Запускает игру и обрабатывает события до тех пор, пока игра не будет завершена.

### `Ecosystem`

Контейнер, содержащий все сущности и ресурсы экосистемы.

*   **Атрибуты:**
    *   `entities`: Список, содержащий все живые существа (экземпляры `Herbivore` и `Predator`).
    *   `resources`: Список, содержащий все ресурсы еды (экземпляры `Food`).
    *   `water_sources`: Список, содержащий все источники воды (экземпляры `Water`).
    *   `map`: Экземпляр класса `Map`, описывающий карту (размер).
    *   `day_night_cycle`:  Экземпляр класса `DayNightCycle`, управляющий сменой дня и ночи.

*   **Методы:**
    *   `add_entity(self, entity)`:  Добавляет сущность (животное) в экосистему.
    *   `remove_entity(self, entity)`:  Удаляет сущность из экосистемы.
    *   `add_resource(self, resource)`:  Добавляет ресурс еды в экосистему.
    *   `remove_resource(self, resource)`:  Удаляет ресурс еды из экосистемы.
    *   `add_water_source(self, water)`:  Добавляет источник воды в экосистему.
    *   `remove_water_source(self, water)`:  Удаляет источник воды из экосистемы.

### `Entity`

Базовый класс для всех живых существ в экосистеме.

*   **Атрибуты:**
    *   `position`:  Вектор (`pygame.math.Vector2`) с координатами сущности на карте.
    *   `speed`:  Скорость движения сущности.

