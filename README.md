# EcoSim: Симуляция Экосистемы на Pygame

EcoSim - это простая симуляция экосистемы, разработанная на языке Python с использованием библиотеки Pygame. Она демонстрирует взаимодействие между травоядными, хищниками, ресурсами (едой и водой) и факторами окружающей среды, такими как смена дня и ночи.

## Обзор

Эта симуляция позволяет наблюдать, как популяции травоядных и хищников изменяются со временем в зависимости от доступности ресурсов и цикла дня и ночи.  Это отличный пример использования объектно-ориентированного программирования и Pygame для создания интерактивной визуализации.

## Основные компоненты

•   **`pygame`**: Библиотека для создания графики и управления событиями.
•   **`random`**:  Генерация случайных чисел для поведения сущностей.
•   **`math`**:  Математические функции (например, вычисление расстояния).
•   **`time`**: Управление временем в симуляции.
•   **`collections.deque`**:  Эффективная структура данных для хранения последних "мест еды" (eating crosses).
•   **`pygame.math`**: Модуль Pygame для векторной математики, упрощающий операции с позициями и направлениями.

## Структура проекта

Проект организован по объектно-ориентированному принципу, где ключевые элементы экосистемы представлены классами.

### 1.  Константы и Глобальные Переменные

Определяются основные параметры игры и экосистемы:

•   `WIDTH`, `HEIGHT`, `FPS`, `TILE_SIZE`: Размеры окна, частота кадров, размер плитки.
•   `DAY_LENGTH`, `NIGHT_LENGTH`, `DAY_COLOR`, `NIGHT_COLOR`, `TRANSITION_DURATION`: Параметры цикла дня и ночи.
•   `WHITE`, `BLACK`, `RED`, `GREEN`, `BLUE`, `BROWN`, `YELLOW`: Цветовые константы.
•   `INITIAL_HERBIVORE_COUNT`, `INITIAL_PREDATOR_COUNT`, `INITIAL_FOOD_COUNT`, `MAX_HERBIVORE_COUNT`, `MAX_PREDATOR_COUNT`, `FOOD_SPAWN_PROBABILITY`:  Начальные значения и ограничения для популяций и ресурсов.

### 2.  Функции

•   **`distance(x1, y1, x2, y2)`**: Вычисляет расстояние между двумя точками.
•   **`normalize(x, y)`**: Нормализует вектор (преобразует его в единичный вектор).  Полезна для определения направления движения.
•   **`lerp_color(color1, color2, t)`**: Линейная интерполяция между двумя цветами. Используется для плавного перехода между дневным и ночным цветом.

### 3.  Классы

•   **`Map`**:  Представляет карту.  Пока содержит только информацию о размерах и отвечает за отрисовку фона.
*   **`ResourceManager`**:  Управляет загрузкой и хранением ресурсов (звуков и изображений). (В текущей версии используется только для музыки, но заложен фундамент для расширения.)
*   **`EatingCross`**:  Отображает место, где хищник съел травоядное.  Постепенно "исчезает", показывая, что "труп" съеден.
*   **`DayNightCycle`**:  Управляет циклом дня и ночи, определяя цвет фона и влияя на поведение сущностей.
    *   `day_length`, `night_length`, `transition_duration`:  Определяют продолжительность дня, ночи и переходов между ними.
    *   `update(dt)`:  Обновляет таймер цикла.
    *   `get_time_progress()`:  Возвращает прогресс в цикле (от 0 до 1).
    *   `is_day()`:  Определяет, сейчас день или ночь.
    *   `get_background_color()`:  Возвращает цвет фона в зависимости от времени суток.
    *   **`Entity`**: Базовый класс для всех живых существ.
    *   `x`, `y`: Положение сущности на карте (используются свойства для автоматического обновления прямоугольника столкновений).
    *   `speed`: Скорость движения.
    *   `size`: Размер.
    *   `health`, `hunger`, `thirst`, `sleep`: Показатели состояния.
    *   `color`: Цвет отрисовки.
    *   `target`: Цель сущности (например, еда, вода, другой организм).
    *   `reproductive_drive`: Желание размножаться.
    *   `update(dt, ecosystem)`:  Обновляет состояние сущности (логика движения, потребление ресурсов, размножение). *Основной метод, определяющий поведение существа.*
    *   `draw(screen)`: Отрисовывает сущность.
    *   `draw_info(screen)`:  Отрисовывает информацию о сущности (здоровье, голод и т.д.).
    *   `find_reproduction_target(entities)`:  Ищет партнера для размножения.
    *   `find_water_target(water_sources)`:  Ищет ближайший источник воды.
    *   `find_nearest(items)`:  Находит ближайший объект из списка.
    *   `avoid_edges(map_obj)`:  Предотвращает выход за границы карты.
    *   `avoid_water(water_sources, dt, entities)`:  Избегает воды при наличии хищников поблизости.
    *   `wander(dt, map_obj)`: Реализует случайное блуждание.
    *   `on_target_reached(ecosystem)`:  Действия при достижении цели.
    *   `avoid_other_entities(dt, entities, is_day)`:  Избегает столкновений с другими существами
    *   `check_for_food_and_water(dt, ecosystem)`:  Проверяет нужды и ищет еду/воду.
    *   **`Predator(Entity)`**: Класс хищника (наследуется от `Entity`).
    *   Специфичное поведение: охота, атака, поедание "трупов" (eating crosses), патрулирование.
    *   `find_target(ecosystem, is_day)`: Ищет травоядное для охоты.
    *   `attack(ecosystem)`:  Атакует травоядное.
    *   `try_eat(ecosystem)`:  Пытается съесть "труп" или атаковать травоядное.
    *   `create_eating_cross(herbivore, map_obj)`: Создает "труп" после убийства травоядного.
    *   `patrol(dt, map_obj)`: Патрулирует территорию в поисках добычи.
    *   `check_reproduce(ecosystem)`: Проверяет, можно ли размножаться.
    *   `reproduce(ecosystem, other)`: Размножается.

    *   **`Herbivore(Entity)`**: Класс травоядного (наследуется от `Entity`).
    *   Специфичное поведение: поиск еды и воды, избегание хищников.
    *   `find_target(ecosystem)`: Ищет еду.
    *   `die(ecosystem)`: Погибает (удаляется из экосистемы).  Вызывается хищником.
    *   `check_reproduce(ecosystem)`: Проверяет, можно ли размножаться.
    *   `reproduce(ecosystem, other)`: Размножается.
    *   **`Ecosystem`**:  Содержит все сущности и ресурсы.
    *   `entities`: Список всех живых существ.
    *   `resources`: Список всех ресурсов (еды).
    *   `water_sources`: Список всех источников воды.
    *   `map`: Объект карты.
    *   `day_night_cycle`: Объект цикла дня и ночи.
    *   `add_entity(entity)`, `remove_entity(entity)`, `add_

